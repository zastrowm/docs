
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
      <meta name="description" content="Documentation for Strands Agents, a simple-to-use, code-first, lightweight library for building AI agents">
    
    
    
      <link rel="canonical" href="https://strandsagents.com/latest/api-reference/agent/">
    
    
      <link rel="prev" href="../../examples/python/mcp_calculator/">
    
    
      <link rel="next" href="../event-loop/">
    
    
    <link rel="icon" href="../../assets/logo-light.png" sizes="any">
    <link rel="icon" href="../../assets/logo-auto.svg" type="image/svg+xml">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">

    
      
        <title>Agent - Strands Agents SDK</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#strands.agent" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Strands Agents SDK" class="md-header__button md-logo" aria-label="Strands Agents SDK" data-md-component="logo">
      <!-- Logo -->

  <img src="../../assets/logo-light.svg" alt="logo" class="logo-light" />
  <img src="../../assets/logo-dark.svg" alt="logo" class="logo-dark" />

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Strands Agents SDK
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Agent
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/strands-agents/sdk-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/strands-agents/sdk-python/blob/main/CONTRIBUTING.md" class="md-tabs__link">
        
  
  
    
  
  Contribute ❤️

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Strands Agents SDK" class="md-nav__button md-logo" aria-label="Strands Agents SDK" data-md-component="logo">
      <!-- Logo -->

  <img src="../../assets/logo-light.svg" alt="logo" class="logo-light" />
  <img src="../../assets/logo-dark.svg" alt="logo" class="logo-dark" />

    </a>
    Strands Agents SDK
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/strands-agents/sdk-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_1" >
        
          
          <label class="md-nav__link" for="__nav_1_3_1" id="__nav_1_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3_1">
            <span class="md-nav__icon md-icon"></span>
            Agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/agents/agent-loop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent Loop
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/agents/sessions-state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sessions & State
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/agents/prompts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prompts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/agents/context-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Context Management
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_2" >
        
          
          <label class="md-nav__link" for="__nav_1_3_2" id="__nav_1_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3_2">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/tools/tools_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/tools/python-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/tools/mcp-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model Context Protocol (MCP)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/tools/example-tools-package/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Example Tools Package
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3_3" id="__nav_1_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Model Providers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3_3">
            <span class="md-nav__icon md-icon"></span>
            Model Providers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/model-providers/amazon-bedrock/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon Bedrock
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/model-providers/anthropic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Anthropic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/model-providers/litellm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LiteLLM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/model-providers/llamaapi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LlamaAPI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/model-providers/ollama/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ollama
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/model-providers/openai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/model-providers/custom_model_provider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Providers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_4" >
        
          
          <label class="md-nav__link" for="__nav_1_3_4" id="__nav_1_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Streaming
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3_4">
            <span class="md-nav__icon md-icon"></span>
            Streaming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/streaming/async-iterators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Async Iterators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/streaming/callback-handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Callback Handlers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_5" >
        
          
          <label class="md-nav__link" for="__nav_1_3_5" id="__nav_1_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Multi-agent
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3_5">
            <span class="md-nav__icon md-icon"></span>
            Multi-agent
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/multi-agent/agents-as-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agents as Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/multi-agent/swarm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Swarm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/multi-agent/graph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Graph
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/concepts/multi-agent/workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Safety & Security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            Safety & Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/safety-security/responsible-ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Responsible AI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/safety-security/guardrails/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guardrails
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/safety-security/prompt-engineering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prompt Engineering
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" >
        
          
          <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Observability & Evaluation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            Observability & Evaluation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/observability-evaluation/observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Observability
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/observability-evaluation/metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/observability-evaluation/traces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Traces
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/observability-evaluation/logs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/observability-evaluation/evaluation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Evaluation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6" >
        
          
          <label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Deploy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6">
            <span class="md-nav__icon md-icon"></span>
            Deploy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/deploy/operating-agents-in-production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operating Agents in Production
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/deploy/deploy_to_aws_lambda/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS Lambda
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/deploy/deploy_to_aws_fargate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS Fargate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/deploy/deploy_to_amazon_eks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon EKS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/deploy/deploy_to_amazon_ec2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon EC2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/python/cli-reference-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI Reference Agent Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/python/weather_forecaster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Weather Forecaster
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/python/memory_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Memory Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/python/file_operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Operations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/python/agents_workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agents Workflows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/python/knowledge_base_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knowledge-Base Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/python/multi_agent_example/multi_agent_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/python/meta_tooling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Meta Tooling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/python/mcp_calculator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MCP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/strands-agents/sdk-python/blob/main/CONTRIBUTING.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contribute ❤️
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Agent
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Agent
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#strands.agent.agent" class="md-nav__link">
    <span class="md-ellipsis">
      agent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent" class="md-nav__link">
    <span class="md-ellipsis">
      Agent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.tool" class="md-nav__link">
    <span class="md-ellipsis">
      tool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.tool_config" class="md-nav__link">
    <span class="md-ellipsis">
      tool_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.tool_names" class="md-nav__link">
    <span class="md-ellipsis">
      tool_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.ToolCaller" class="md-nav__link">
    <span class="md-ellipsis">
      ToolCaller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ToolCaller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.ToolCaller.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __getattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.ToolCaller.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.__del__" class="md-nav__link">
    <span class="md-ellipsis">
      __del__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.stream_async" class="md-nav__link">
    <span class="md-ellipsis">
      stream_async
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#strands.agent.agent_result" class="md-nav__link">
    <span class="md-ellipsis">
      agent_result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="agent_result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent_result.AgentResult" class="md-nav__link">
    <span class="md-ellipsis">
      AgentResult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AgentResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent_result.AgentResult.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager" class="md-nav__link">
    <span class="md-ellipsis">
      conversation_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="conversation_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.conversation_manager" class="md-nav__link">
    <span class="md-ellipsis">
      conversation_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="conversation_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.conversation_manager.ConversationManager" class="md-nav__link">
    <span class="md-ellipsis">
      ConversationManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConversationManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.conversation_manager.ConversationManager.apply_management" class="md-nav__link">
    <span class="md-ellipsis">
      apply_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.conversation_manager.ConversationManager.reduce_context" class="md-nav__link">
    <span class="md-ellipsis">
      reduce_context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.null_conversation_manager" class="md-nav__link">
    <span class="md-ellipsis">
      null_conversation_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="null_conversation_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.null_conversation_manager.NullConversationManager" class="md-nav__link">
    <span class="md-ellipsis">
      NullConversationManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NullConversationManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.null_conversation_manager.NullConversationManager.apply_management" class="md-nav__link">
    <span class="md-ellipsis">
      apply_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.null_conversation_manager.NullConversationManager.reduce_context" class="md-nav__link">
    <span class="md-ellipsis">
      reduce_context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager" class="md-nav__link">
    <span class="md-ellipsis">
      sliding_window_conversation_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sliding_window_conversation_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager" class="md-nav__link">
    <span class="md-ellipsis">
      SlidingWindowConversationManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SlidingWindowConversationManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager.apply_management" class="md-nav__link">
    <span class="md-ellipsis">
      apply_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager.reduce_context" class="md-nav__link">
    <span class="md-ellipsis">
      reduce_context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.is_assistant_message" class="md-nav__link">
    <span class="md-ellipsis">
      is_assistant_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.is_user_message" class="md-nav__link">
    <span class="md-ellipsis">
      is_user_message
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../event-loop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event Loop
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handlers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../telemetry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Telemetry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Types
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#strands.agent.agent" class="md-nav__link">
    <span class="md-ellipsis">
      agent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent" class="md-nav__link">
    <span class="md-ellipsis">
      Agent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.tool" class="md-nav__link">
    <span class="md-ellipsis">
      tool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.tool_config" class="md-nav__link">
    <span class="md-ellipsis">
      tool_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.tool_names" class="md-nav__link">
    <span class="md-ellipsis">
      tool_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.ToolCaller" class="md-nav__link">
    <span class="md-ellipsis">
      ToolCaller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ToolCaller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.ToolCaller.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __getattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.ToolCaller.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.__del__" class="md-nav__link">
    <span class="md-ellipsis">
      __del__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent.Agent.stream_async" class="md-nav__link">
    <span class="md-ellipsis">
      stream_async
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#strands.agent.agent_result" class="md-nav__link">
    <span class="md-ellipsis">
      agent_result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="agent_result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent_result.AgentResult" class="md-nav__link">
    <span class="md-ellipsis">
      AgentResult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AgentResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.agent_result.AgentResult.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager" class="md-nav__link">
    <span class="md-ellipsis">
      conversation_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="conversation_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.conversation_manager" class="md-nav__link">
    <span class="md-ellipsis">
      conversation_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="conversation_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.conversation_manager.ConversationManager" class="md-nav__link">
    <span class="md-ellipsis">
      ConversationManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConversationManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.conversation_manager.ConversationManager.apply_management" class="md-nav__link">
    <span class="md-ellipsis">
      apply_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.conversation_manager.ConversationManager.reduce_context" class="md-nav__link">
    <span class="md-ellipsis">
      reduce_context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.null_conversation_manager" class="md-nav__link">
    <span class="md-ellipsis">
      null_conversation_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="null_conversation_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.null_conversation_manager.NullConversationManager" class="md-nav__link">
    <span class="md-ellipsis">
      NullConversationManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NullConversationManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.null_conversation_manager.NullConversationManager.apply_management" class="md-nav__link">
    <span class="md-ellipsis">
      apply_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.null_conversation_manager.NullConversationManager.reduce_context" class="md-nav__link">
    <span class="md-ellipsis">
      reduce_context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager" class="md-nav__link">
    <span class="md-ellipsis">
      sliding_window_conversation_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sliding_window_conversation_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager" class="md-nav__link">
    <span class="md-ellipsis">
      SlidingWindowConversationManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SlidingWindowConversationManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager.apply_management" class="md-nav__link">
    <span class="md-ellipsis">
      apply_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager.reduce_context" class="md-nav__link">
    <span class="md-ellipsis">
      reduce_context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.is_assistant_message" class="md-nav__link">
    <span class="md-ellipsis">
      is_assistant_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.is_user_message" class="md-nav__link">
    <span class="md-ellipsis">
      is_user_message
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<div class="doc doc-object doc-module">



<h1 id="strands.agent" class="doc doc-heading">
            <code>strands.agent</code>


<a href="#strands.agent" class="headerlink" title="Permanent link">&para;</a></h1>

    <div class="doc doc-contents first">

        <p>This package provides the core Agent interface and supporting components for building AI agents with the SDK.</p>
<p>It includes:</p>
<ul>
<li>Agent: The main interface for interacting with AI models and tools</li>
<li>ConversationManager: Classes for managing conversation history and context windows</li>
</ul>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="strands.agent.agent" class="doc doc-heading">
            <code>strands.agent.agent</code>


<a href="#strands.agent.agent" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Agent Interface.</p>
<p>This module implements the core Agent class that serves as the primary entry point for interacting with foundation
models and tools in the SDK.</p>
<p>The Agent interface supports two complementary interaction patterns:</p>
<ol>
<li>Natural language for conversation: <code>agent("Analyze this data")</code></li>
<li>Method-style for direct tool access: <code>agent.tool.tool_name(param1="value")</code></li>
</ol>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="strands.agent.agent.Agent" class="doc doc-heading">
            <code>Agent</code>


<a href="#strands.agent.agent.Agent" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">


        <p>Core Agent interface.</p>
<p>An agent orchestrates the following workflow:</p>
<ol>
<li>Receives user input</li>
<li>Processes the input using a language model</li>
<li>Decides whether to use tools to gather information or perform actions</li>
<li>Executes those tools and receives results</li>
<li>Continues reasoning with the new information</li>
<li>Produces a final response</li>
</ol>







              <details class="quote">
                <summary>Source code in <code>strands/agent/agent.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Agent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Core Agent interface.</span>

<span class="sd">    An agent orchestrates the following workflow:</span>

<span class="sd">    1. Receives user input</span>
<span class="sd">    2. Processes the input using a language model</span>
<span class="sd">    3. Decides whether to use tools to gather information or perform actions</span>
<span class="sd">    4. Executes those tools and receives results</span>
<span class="sd">    5. Continues reasoning with the new information</span>
<span class="sd">    6. Produces a final response</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">ToolCaller</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call tool as a function.&quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Initialize instance.</span>

<span class="sd">            Args:</span>
<span class="sd">                agent: Agent reference that will accept tool results.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># WARNING: Do not add any other member variables or methods as this could result in a name conflict with</span>
            <span class="c1">#          agent tools and thus break their execution.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="o">=</span> <span class="n">agent</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Call tool as a function.</span>

<span class="sd">            This method enables the method-style interface (e.g., `agent.tool.tool_name(param=&quot;value&quot;)`).</span>

<span class="sd">            Args:</span>
<span class="sd">                name: The name of the attribute (tool) being accessed.</span>

<span class="sd">            Returns:</span>
<span class="sd">                A function that when called will execute the named tool.</span>

<span class="sd">            Raises:</span>
<span class="sd">                AttributeError: If no tool with the given name exists.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">caller</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;Call a tool directly by name.</span>

<span class="sd">                Args:</span>
<span class="sd">                    **kwargs: Keyword arguments to pass to the tool.</span>

<span class="sd">                        - user_message_override: Custom message to record instead of default</span>
<span class="sd">                        - tool_execution_handler: Custom handler for tool execution</span>
<span class="sd">                        - event_loop_metrics: Custom metrics collector</span>
<span class="sd">                        - messages: Custom message history to use</span>
<span class="sd">                        - tool_config: Custom tool configuration</span>
<span class="sd">                        - callback_handler: Custom callback handler</span>
<span class="sd">                        - record_direct_tool_call: Whether to record this call in history</span>

<span class="sd">                Returns:</span>
<span class="sd">                    The result returned by the tool.</span>

<span class="sd">                Raises:</span>
<span class="sd">                    AttributeError: If the tool doesn&#39;t exist.</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">tool_registry</span><span class="o">.</span><span class="n">registry</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>

                <span class="c1"># Create unique tool ID and set up the tool request</span>
                <span class="n">tool_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;tooluse_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100000000</span><span class="p">,</span><span class="w"> </span><span class="mi">999999999</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">tool_use</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;toolUseId&quot;</span><span class="p">:</span> <span class="n">tool_id</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                <span class="p">}</span>

                <span class="c1"># Extract tool execution parameters</span>
                <span class="n">user_message_override</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_message_override&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">tool_execution_handler</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_execution_handler&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">thread_pool_wrapper</span><span class="p">)</span>
                <span class="n">event_loop_metrics</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_loop_metrics&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">event_loop_metrics</span><span class="p">)</span>
                <span class="n">messages</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;messages&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
                <span class="n">tool_config</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_config&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">tool_config</span><span class="p">)</span>
                <span class="n">callback_handler</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;callback_handler&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">callback_handler</span><span class="p">)</span>
                <span class="n">record_direct_tool_call</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;record_direct_tool_call&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">record_direct_tool_call</span><span class="p">)</span>

                <span class="c1"># Process tool call</span>
                <span class="n">handler_kwargs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">k</span>
                    <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="s2">&quot;tool_execution_handler&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;event_loop_metrics&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;messages&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;tool_config&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;callback_handler&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;tool_handler&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;system_prompt&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;model&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;model_id&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;user_message_override&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;agent&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;record_direct_tool_call&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">}</span>

                <span class="c1"># Execute the tool</span>
                <span class="n">tool_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">tool_handler</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                    <span class="n">tool</span><span class="o">=</span><span class="n">tool_use</span><span class="p">,</span>
                    <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                    <span class="n">system_prompt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">system_prompt</span><span class="p">,</span>
                    <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
                    <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
                    <span class="n">callback_handler</span><span class="o">=</span><span class="n">callback_handler</span><span class="p">,</span>
                    <span class="n">tool_execution_handler</span><span class="o">=</span><span class="n">tool_execution_handler</span><span class="p">,</span>
                    <span class="n">event_loop_metrics</span><span class="o">=</span><span class="n">event_loop_metrics</span><span class="p">,</span>
                    <span class="n">agent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">handler_kwargs</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">record_direct_tool_call</span><span class="p">:</span>
                    <span class="c1"># Create a record of this tool execution in the message history</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">_record_tool_execution</span><span class="p">(</span><span class="n">tool_use</span><span class="p">,</span> <span class="n">tool_result</span><span class="p">,</span> <span class="n">user_message_override</span><span class="p">,</span> <span class="n">messages</span><span class="p">)</span>

                <span class="c1"># Apply window management</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">conversation_manager</span><span class="o">.</span><span class="n">apply_management</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">tool_result</span>

            <span class="k">return</span> <span class="n">caller</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Model</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">messages</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Messages</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">system_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">callback_handler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">_DefaultCallbackHandlerSentinel</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">_DEFAULT_CALLBACK_HANDLER</span><span class="p">,</span>
        <span class="n">conversation_manager</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConversationManager</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_parallel_tools</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">record_direct_tool_call</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">load_tools_from_directory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">trace_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AttributeValue</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Agent with the specified configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            model: Provider for running inference or a string representing the model-id for Bedrock to use.</span>
<span class="sd">                Defaults to strands.models.BedrockModel if None.</span>
<span class="sd">            messages: List of initial messages to pre-load into the conversation.</span>
<span class="sd">                Defaults to an empty list if None.</span>
<span class="sd">            tools: List of tools to make available to the agent.</span>
<span class="sd">                Can be specified as:</span>

<span class="sd">                - String tool names (e.g., &quot;retrieve&quot;)</span>
<span class="sd">                - File paths (e.g., &quot;/path/to/tool.py&quot;)</span>
<span class="sd">                - Imported Python modules (e.g., from strands_tools import current_time)</span>
<span class="sd">                - Dictionaries with name/path keys (e.g., {&quot;name&quot;: &quot;tool_name&quot;, &quot;path&quot;: &quot;/path/to/tool.py&quot;})</span>
<span class="sd">                - Functions decorated with `@strands.tool` decorator.</span>

<span class="sd">                If provided, only these tools will be available. If None, all tools will be available.</span>
<span class="sd">            system_prompt: System prompt to guide model behavior.</span>
<span class="sd">                If None, the model will behave according to its default settings.</span>
<span class="sd">            callback_handler: Callback for processing events as they happen during agent execution.</span>
<span class="sd">                If not provided (using the default), a new PrintingCallbackHandler instance is created.</span>
<span class="sd">                If explicitly set to None, null_callback_handler is used.</span>
<span class="sd">            conversation_manager: Manager for conversation history and context window.</span>
<span class="sd">                Defaults to strands.agent.conversation_manager.SlidingWindowConversationManager if None.</span>
<span class="sd">            max_parallel_tools: Maximum number of tools to run in parallel when the model returns multiple tool calls.</span>
<span class="sd">                Defaults to os.cpu_count() or 1.</span>
<span class="sd">            record_direct_tool_call: Whether to record direct tool calls in message history.</span>
<span class="sd">                Defaults to True.</span>
<span class="sd">            load_tools_from_directory: Whether to load and automatically reload tools in the `./tools/` directory.</span>
<span class="sd">                Defaults to True.</span>
<span class="sd">            trace_attributes: Custom trace attributes to apply to the agent&#39;s trace span.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If max_parallel_tools is less than 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">BedrockModel</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span> <span class="k">else</span> <span class="n">BedrockModel</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">model</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="n">messages</span> <span class="k">if</span> <span class="n">messages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">system_prompt</span> <span class="o">=</span> <span class="n">system_prompt</span>

        <span class="c1"># If not provided, create a new PrintingCallbackHandler instance</span>
        <span class="c1"># If explicitly set to None, use null_callback_handler</span>
        <span class="c1"># Otherwise use the passed callback_handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_handler</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">PrintingCallbackHandler</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback_handler</span><span class="p">,</span> <span class="n">_DefaultCallbackHandlerSentinel</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callback_handler</span> <span class="o">=</span> <span class="n">PrintingCallbackHandler</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">callback_handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callback_handler</span> <span class="o">=</span> <span class="n">null_callback_handler</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callback_handler</span> <span class="o">=</span> <span class="n">callback_handler</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conversation_manager</span> <span class="o">=</span> <span class="n">conversation_manager</span> <span class="k">if</span> <span class="n">conversation_manager</span> <span class="k">else</span> <span class="n">SlidingWindowConversationManager</span><span class="p">()</span>

        <span class="c1"># Process trace attributes to ensure they&#39;re of compatible types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AttributeValue</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">trace_attributes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">trace_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trace_attributes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c1"># If max_parallel_tools is 1, we execute tools sequentially</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool_wrapper</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">max_parallel_tools</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_parallel_tools</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool_wrapper</span> <span class="o">=</span> <span class="n">ThreadPoolExecutorWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread_pool</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">max_parallel_tools</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_parallel_tools must be greater than 0&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">record_direct_tool_call</span> <span class="o">=</span> <span class="n">record_direct_tool_call</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_tools_from_directory</span> <span class="o">=</span> <span class="n">load_tools_from_directory</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tool_registry</span> <span class="o">=</span> <span class="n">ToolRegistry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tool_handler</span> <span class="o">=</span> <span class="n">AgentToolHandler</span><span class="p">(</span><span class="n">tool_registry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tool_registry</span><span class="p">)</span>

        <span class="c1"># Process tool list if provided</span>
        <span class="k">if</span> <span class="n">tools</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tool_registry</span><span class="o">.</span><span class="n">process_tools</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>

        <span class="c1"># Initialize tools and configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tool_registry</span><span class="o">.</span><span class="n">initialize_tools</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_tools_from_directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">load_tools_from_directory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tool_watcher</span> <span class="o">=</span> <span class="n">ToolWatcher</span><span class="p">(</span><span class="n">tool_registry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tool_registry</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event_loop_metrics</span> <span class="o">=</span> <span class="n">EventLoopMetrics</span><span class="p">()</span>

        <span class="c1"># Initialize tracer instance (no-op if not configured)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracer</span> <span class="o">=</span> <span class="n">get_tracer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_span</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">trace</span><span class="o">.</span><span class="n">Span</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tool_caller</span> <span class="o">=</span> <span class="n">Agent</span><span class="o">.</span><span class="n">ToolCaller</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tool</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToolCaller</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call tool as a function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tool caller through which user can invoke tool as a function.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```</span>
<span class="sd">            agent = Agent(tools=[calculator])</span>
<span class="sd">            agent.tool.calculator(...)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_caller</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tool_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of all registered tool names.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Names of all tools available to this agent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_registry</span><span class="o">.</span><span class="n">get_all_tools_config</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_tools</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tool_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToolConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the tool configuration for this agent.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The complete tool configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_registry</span><span class="o">.</span><span class="n">initialize_tool_config</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up resources when Agent is garbage collected.</span>

<span class="sd">        Ensures proper shutdown of the thread pool executor if one exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool_wrapper</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread_pool_wrapper</span><span class="p">,</span> <span class="s2">&quot;shutdown&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool_wrapper</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;thread pool executor shutdown complete&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a natural language prompt through the agent&#39;s event loop.</span>

<span class="sd">        This method implements the conversational interface (e.g., `agent(&quot;hello!&quot;)`). It adds the user&#39;s prompt to</span>
<span class="sd">        the conversation history, processes it through the model, executes any tool calls, and returns the final result.</span>

<span class="sd">        Args:</span>
<span class="sd">            prompt: The natural language prompt from the user.</span>
<span class="sd">            **kwargs: Additional parameters to pass to the event loop.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Result object containing:</span>

<span class="sd">                - stop_reason: Why the event loop stopped (e.g., &quot;end_turn&quot;, &quot;max_tokens&quot;)</span>
<span class="sd">                - message: The final message from the model</span>
<span class="sd">                - metrics: Performance metrics from the event loop</span>
<span class="sd">                - state: The final state of the event loop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_agent_trace_span</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Run the event loop and get the result</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_loop</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_end_agent_trace_span</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_agent_trace_span</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>

            <span class="c1"># Re-raise the exception to preserve original behavior</span>
            <span class="k">raise</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stream_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a natural language prompt and yield events as an async iterator.</span>

<span class="sd">        This method provides an asynchronous interface for streaming agent events, allowing</span>
<span class="sd">        consumers to process stream events programmatically through an async iterator pattern</span>
<span class="sd">        rather than callback functions. This is particularly useful for web servers and other</span>
<span class="sd">        async environments.</span>

<span class="sd">        Args:</span>
<span class="sd">            prompt: The natural language prompt from the user.</span>
<span class="sd">            **kwargs: Additional parameters to pass to the event loop.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An async iterator that yields events. Each event is a dictionary containing</span>
<span class="sd">            information about the current state of processing, such as:</span>
<span class="sd">            - data: Text content being generated</span>
<span class="sd">            - complete: Whether this is the final chunk</span>
<span class="sd">            - current_tool_use: Information about tools being executed</span>
<span class="sd">            - And other event data provided by the callback handler</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: Any exceptions from the agent invocation will be propagated to the caller.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            async for event in agent.stream_async(&quot;Analyze this data&quot;):</span>
<span class="sd">                if &quot;data&quot; in event:</span>
<span class="sd">                    yield event[&quot;data&quot;]</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_agent_trace_span</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

        <span class="n">_stop_event</span> <span class="o">=</span> <span class="n">uuid4</span><span class="p">()</span>

        <span class="n">queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">[</span><span class="n">Any</span><span class="p">]()</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">enqueue</span><span class="p">(</span><span class="n">an_item</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">nonlocal</span> <span class="n">queue</span>
            <span class="k">nonlocal</span> <span class="n">loop</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">call_soon_threadsafe</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">,</span> <span class="n">an_item</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">queuing_callback_handler</span><span class="p">(</span><span class="o">**</span><span class="n">handler_kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">enqueue</span><span class="p">(</span><span class="n">handler_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">target_callback</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">nonlocal</span> <span class="n">kwargs</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_loop</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">supplementary_callback_handler</span><span class="o">=</span><span class="n">queuing_callback_handler</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_end_agent_trace_span</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_end_agent_trace_span</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
                <span class="n">enqueue</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">enqueue</span><span class="p">(</span><span class="n">_stop_event</span><span class="p">)</span>

        <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target_callback</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">_stop_event</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">item</span>
                <span class="k">yield</span> <span class="n">item</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_run_loop</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">supplementary_callback_handler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the agent&#39;s event loop with the given prompt and parameters.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># If the call had a callback_handler passed in, then for this event_loop</span>
            <span class="c1"># cycle we call both handlers as the callback_handler</span>
            <span class="n">invocation_callback_handler</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">CompositeCallbackHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_handler</span><span class="p">,</span> <span class="n">supplementary_callback_handler</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">supplementary_callback_handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_handler</span>
            <span class="p">)</span>

            <span class="c1"># Extract key parameters</span>
            <span class="n">invocation_callback_handler</span><span class="p">(</span><span class="n">init_event_loop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># Set up the user message with optional knowledge base retrieval</span>
            <span class="n">message_content</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ContentBlock</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}]</span>
            <span class="n">new_message</span><span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">message_content</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_message</span><span class="p">)</span>

            <span class="c1"># Execute the event loop cycle with retry logic for context limits</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_event_loop_cycle</span><span class="p">(</span><span class="n">invocation_callback_handler</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conversation_manager</span><span class="o">.</span><span class="n">apply_management</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_execute_event_loop_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AgentResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the event loop cycle with retry logic for context window limits.</span>

<span class="sd">        This internal method handles the execution of the event loop cycle and implements</span>
<span class="sd">        retry logic for handling context window overflow exceptions by reducing the</span>
<span class="sd">        conversation context and retrying.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The result of the event loop cycle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract parameters with fallbacks to instance values</span>
        <span class="n">system_prompt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;system_prompt&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_prompt</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="n">tool_execution_handler</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tool_execution_handler&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool_wrapper</span><span class="p">)</span>
        <span class="n">event_loop_metrics</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;event_loop_metrics&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_loop_metrics</span><span class="p">)</span>
        <span class="n">callback_handler_override</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;callback_handler&quot;</span><span class="p">,</span> <span class="n">callback_handler</span><span class="p">)</span>
        <span class="n">tool_handler</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tool_handler&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_handler</span><span class="p">)</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;messages&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
        <span class="n">tool_config</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tool_config&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_config</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;agent&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Remove agent to avoid conflicts</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Execute the main event loop cycle</span>
            <span class="n">stop_reason</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">event_loop_cycle</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">system_prompt</span><span class="o">=</span><span class="n">system_prompt</span><span class="p">,</span>
                <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>  <span class="c1"># will be modified by event_loop_cycle</span>
                <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
                <span class="n">callback_handler</span><span class="o">=</span><span class="n">callback_handler_override</span><span class="p">,</span>
                <span class="n">tool_handler</span><span class="o">=</span><span class="n">tool_handler</span><span class="p">,</span>
                <span class="n">tool_execution_handler</span><span class="o">=</span><span class="n">tool_execution_handler</span><span class="p">,</span>
                <span class="n">event_loop_metrics</span><span class="o">=</span><span class="n">event_loop_metrics</span><span class="p">,</span>
                <span class="n">agent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">event_loop_parent_span</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_span</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">AgentResult</span><span class="p">(</span><span class="n">stop_reason</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">ContextWindowOverflowException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Try reducing the context size and retrying</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">conversation_manager</span><span class="o">.</span><span class="n">reduce_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_event_loop_cycle</span><span class="p">(</span><span class="n">callback_handler_override</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_record_tool_execution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tool</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">tool_result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">user_message_override</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a tool execution in the message history.</span>

<span class="sd">        Creates a sequence of messages that represent the tool execution:</span>

<span class="sd">        1. A user message describing the tool call</span>
<span class="sd">        2. An assistant message with the tool use</span>
<span class="sd">        3. A user message with the tool result</span>
<span class="sd">        4. An assistant message acknowledging the tool call</span>

<span class="sd">        Args:</span>
<span class="sd">            tool: The tool call information.</span>
<span class="sd">            tool_result: The result returned by the tool.</span>
<span class="sd">            user_message_override: Optional custom message to include.</span>
<span class="sd">            messages: The message history to append to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create user message describing the tool call</span>
        <span class="n">user_msg_content</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;agent.tool.</span><span class="si">{</span><span class="n">tool</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> direct tool call.</span><span class="se">\n</span><span class="s2">Input parameters: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">tool</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)}</span>
        <span class="p">]</span>

        <span class="c1"># Add override message if provided</span>
        <span class="k">if</span> <span class="n">user_message_override</span><span class="p">:</span>
            <span class="n">user_msg_content</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_message_override</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">})</span>

        <span class="c1"># Create the message sequence</span>
        <span class="n">user_msg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">user_msg_content</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">tool_use_msg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;toolUse&quot;</span><span class="p">:</span> <span class="n">tool</span><span class="p">}],</span>
        <span class="p">}</span>
        <span class="n">tool_result_msg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;toolResult&quot;</span><span class="p">:</span> <span class="n">tool_result</span><span class="p">}],</span>
        <span class="p">}</span>
        <span class="n">assistant_msg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;agent.</span><span class="si">{</span><span class="n">tool</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> was called&quot;</span><span class="p">}],</span>
        <span class="p">}</span>

        <span class="c1"># Add to message history</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_msg</span><span class="p">)</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool_use_msg</span><span class="p">)</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool_result_msg</span><span class="p">)</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assistant_msg</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_start_agent_trace_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts a trace span for the agent.</span>

<span class="sd">        Args:</span>
<span class="sd">            prompt: The natural language prompt from the user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trace_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracer</span><span class="o">.</span><span class="n">start_agent_span</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
            <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tool_names</span><span class="p">,</span>
            <span class="n">system_prompt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">system_prompt</span><span class="p">,</span>
            <span class="n">custom_trace_attributes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_attributes</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_end_agent_trace_span</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">response</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AgentResult</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ends a trace span for the agent.</span>

<span class="sd">        Args:</span>
<span class="sd">            span: The span to end.</span>
<span class="sd">            response: Response to record as a trace attribute.</span>
<span class="sd">            error: Error to record as a trace attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_span</span><span class="p">:</span>
            <span class="n">trace_attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;span&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_span</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">trace_attributes</span><span class="p">[</span><span class="s2">&quot;response&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span>
            <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                <span class="n">trace_attributes</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tracer</span><span class="o">.</span><span class="n">end_agent_span</span><span class="p">(</span><span class="o">**</span><span class="n">trace_attributes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="strands.agent.agent.Agent.tool" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#strands.agent.agent.Agent.tool" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Call tool as a function.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ToolCaller (strands.agent.agent.Agent.ToolCaller)" href="#strands.agent.agent.Agent.ToolCaller">ToolCaller</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tool caller through which user can invoke tool as a function.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code>agent = Agent(tools=[calculator])
agent.tool.calculator(...)
</code></pre></div>
</details>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="strands.agent.agent.Agent.tool_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tool_config</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#strands.agent.agent.Agent.tool_config" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get the tool configuration for this agent.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ToolConfig (strands.types.tools.ToolConfig)" href="../types/#strands.types.tools.ToolConfig">ToolConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complete tool configuration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="strands.agent.agent.Agent.tool_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tool_names</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#strands.agent.agent.Agent.tool_names" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get a list of all registered tool names.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of all tools available to this agent.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>


<div class="doc doc-object doc-class">



<h4 id="strands.agent.agent.Agent.ToolCaller" class="doc doc-heading">
            <code>ToolCaller</code>


<a href="#strands.agent.agent.Agent.ToolCaller" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Call tool as a function.</p>







              <details class="quote">
                <summary>Source code in <code>strands/agent/agent.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ToolCaller</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call tool as a function.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            agent: Agent reference that will accept tool results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># WARNING: Do not add any other member variables or methods as this could result in a name conflict with</span>
        <span class="c1">#          agent tools and thus break their execution.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="o">=</span> <span class="n">agent</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call tool as a function.</span>

<span class="sd">        This method enables the method-style interface (e.g., `agent.tool.tool_name(param=&quot;value&quot;)`).</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the attribute (tool) being accessed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A function that when called will execute the named tool.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AttributeError: If no tool with the given name exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">caller</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Call a tool directly by name.</span>

<span class="sd">            Args:</span>
<span class="sd">                **kwargs: Keyword arguments to pass to the tool.</span>

<span class="sd">                    - user_message_override: Custom message to record instead of default</span>
<span class="sd">                    - tool_execution_handler: Custom handler for tool execution</span>
<span class="sd">                    - event_loop_metrics: Custom metrics collector</span>
<span class="sd">                    - messages: Custom message history to use</span>
<span class="sd">                    - tool_config: Custom tool configuration</span>
<span class="sd">                    - callback_handler: Custom callback handler</span>
<span class="sd">                    - record_direct_tool_call: Whether to record this call in history</span>

<span class="sd">            Returns:</span>
<span class="sd">                The result returned by the tool.</span>

<span class="sd">            Raises:</span>
<span class="sd">                AttributeError: If the tool doesn&#39;t exist.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">tool_registry</span><span class="o">.</span><span class="n">registry</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>

            <span class="c1"># Create unique tool ID and set up the tool request</span>
            <span class="n">tool_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;tooluse_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100000000</span><span class="p">,</span><span class="w"> </span><span class="mi">999999999</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">tool_use</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;toolUseId&quot;</span><span class="p">:</span> <span class="n">tool_id</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="p">}</span>

            <span class="c1"># Extract tool execution parameters</span>
            <span class="n">user_message_override</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_message_override&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">tool_execution_handler</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_execution_handler&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">thread_pool_wrapper</span><span class="p">)</span>
            <span class="n">event_loop_metrics</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_loop_metrics&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">event_loop_metrics</span><span class="p">)</span>
            <span class="n">messages</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;messages&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
            <span class="n">tool_config</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_config&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">tool_config</span><span class="p">)</span>
            <span class="n">callback_handler</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;callback_handler&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">callback_handler</span><span class="p">)</span>
            <span class="n">record_direct_tool_call</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;record_direct_tool_call&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">record_direct_tool_call</span><span class="p">)</span>

            <span class="c1"># Process tool call</span>
            <span class="n">handler_kwargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span>
                <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">&quot;tool_execution_handler&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;event_loop_metrics&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;messages&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;tool_config&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;callback_handler&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;tool_handler&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;system_prompt&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;model&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;model_id&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;user_message_override&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;agent&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;record_direct_tool_call&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">}</span>

            <span class="c1"># Execute the tool</span>
            <span class="n">tool_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">tool_handler</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                <span class="n">tool</span><span class="o">=</span><span class="n">tool_use</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                <span class="n">system_prompt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">system_prompt</span><span class="p">,</span>
                <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
                <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
                <span class="n">callback_handler</span><span class="o">=</span><span class="n">callback_handler</span><span class="p">,</span>
                <span class="n">tool_execution_handler</span><span class="o">=</span><span class="n">tool_execution_handler</span><span class="p">,</span>
                <span class="n">event_loop_metrics</span><span class="o">=</span><span class="n">event_loop_metrics</span><span class="p">,</span>
                <span class="n">agent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="p">,</span>
                <span class="o">**</span><span class="n">handler_kwargs</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">record_direct_tool_call</span><span class="p">:</span>
                <span class="c1"># Create a record of this tool execution in the message history</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">_record_tool_execution</span><span class="p">(</span><span class="n">tool_use</span><span class="p">,</span> <span class="n">tool_result</span><span class="p">,</span> <span class="n">user_message_override</span><span class="p">,</span> <span class="n">messages</span><span class="p">)</span>

            <span class="c1"># Apply window management</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">conversation_manager</span><span class="o">.</span><span class="n">apply_management</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">tool_result</span>

        <span class="k">return</span> <span class="n">caller</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="strands.agent.agent.Agent.ToolCaller.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#strands.agent.agent.Agent.ToolCaller.__getattr__" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Call tool as a function.</p>
<p>This method enables the method-style interface (e.g., <code>agent.tool.tool_name(param="value")</code>).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the attribute (tool) being accessed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Callable">Callable</span>[..., <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function that when called will execute the named tool.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no tool with the given name exists.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call tool as a function.</span>

<span class="sd">    This method enables the method-style interface (e.g., `agent.tool.tool_name(param=&quot;value&quot;)`).</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The name of the attribute (tool) being accessed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A function that when called will execute the named tool.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AttributeError: If no tool with the given name exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">caller</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call a tool directly by name.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the tool.</span>

<span class="sd">                - user_message_override: Custom message to record instead of default</span>
<span class="sd">                - tool_execution_handler: Custom handler for tool execution</span>
<span class="sd">                - event_loop_metrics: Custom metrics collector</span>
<span class="sd">                - messages: Custom message history to use</span>
<span class="sd">                - tool_config: Custom tool configuration</span>
<span class="sd">                - callback_handler: Custom callback handler</span>
<span class="sd">                - record_direct_tool_call: Whether to record this call in history</span>

<span class="sd">        Returns:</span>
<span class="sd">            The result returned by the tool.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AttributeError: If the tool doesn&#39;t exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">tool_registry</span><span class="o">.</span><span class="n">registry</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>

        <span class="c1"># Create unique tool ID and set up the tool request</span>
        <span class="n">tool_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;tooluse_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100000000</span><span class="p">,</span><span class="w"> </span><span class="mi">999999999</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">tool_use</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;toolUseId&quot;</span><span class="p">:</span> <span class="n">tool_id</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="c1"># Extract tool execution parameters</span>
        <span class="n">user_message_override</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_message_override&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">tool_execution_handler</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_execution_handler&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">thread_pool_wrapper</span><span class="p">)</span>
        <span class="n">event_loop_metrics</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_loop_metrics&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">event_loop_metrics</span><span class="p">)</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;messages&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
        <span class="n">tool_config</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_config&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">tool_config</span><span class="p">)</span>
        <span class="n">callback_handler</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;callback_handler&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">callback_handler</span><span class="p">)</span>
        <span class="n">record_direct_tool_call</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;record_direct_tool_call&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">record_direct_tool_call</span><span class="p">)</span>

        <span class="c1"># Process tool call</span>
        <span class="n">handler_kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span>
            <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;tool_execution_handler&quot;</span><span class="p">,</span>
                <span class="s2">&quot;event_loop_metrics&quot;</span><span class="p">,</span>
                <span class="s2">&quot;messages&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tool_config&quot;</span><span class="p">,</span>
                <span class="s2">&quot;callback_handler&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tool_handler&quot;</span><span class="p">,</span>
                <span class="s2">&quot;system_prompt&quot;</span><span class="p">,</span>
                <span class="s2">&quot;model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;model_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;user_message_override&quot;</span><span class="p">,</span>
                <span class="s2">&quot;agent&quot;</span><span class="p">,</span>
                <span class="s2">&quot;record_direct_tool_call&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># Execute the tool</span>
        <span class="n">tool_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">tool_handler</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
            <span class="n">tool</span><span class="o">=</span><span class="n">tool_use</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">system_prompt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">system_prompt</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
            <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
            <span class="n">callback_handler</span><span class="o">=</span><span class="n">callback_handler</span><span class="p">,</span>
            <span class="n">tool_execution_handler</span><span class="o">=</span><span class="n">tool_execution_handler</span><span class="p">,</span>
            <span class="n">event_loop_metrics</span><span class="o">=</span><span class="n">event_loop_metrics</span><span class="p">,</span>
            <span class="n">agent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="p">,</span>
            <span class="o">**</span><span class="n">handler_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">record_direct_tool_call</span><span class="p">:</span>
            <span class="c1"># Create a record of this tool execution in the message history</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">_record_tool_execution</span><span class="p">(</span><span class="n">tool_use</span><span class="p">,</span> <span class="n">tool_result</span><span class="p">,</span> <span class="n">user_message_override</span><span class="p">,</span> <span class="n">messages</span><span class="p">)</span>

        <span class="c1"># Apply window management</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">conversation_manager</span><span class="o">.</span><span class="n">apply_management</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tool_result</span>

    <span class="k">return</span> <span class="n">caller</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="strands.agent.agent.Agent.ToolCaller.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span></code>

<a href="#strands.agent.agent.Agent.ToolCaller.__init__" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Initialize instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>agent</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Agent (strands.agent.agent.Agent)" href="#strands.agent.agent.Agent">Agent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Agent reference that will accept tool results.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        agent: Agent reference that will accept tool results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># WARNING: Do not add any other member variables or methods as this could result in a name conflict with</span>
    <span class="c1">#          agent tools and thus break their execution.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="o">=</span> <span class="n">agent</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="strands.agent.agent.Agent.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#strands.agent.agent.Agent.__call__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Process a natural language prompt through the agent's event loop.</p>
<p>This method implements the conversational interface (e.g., <code>agent("hello!")</code>). It adds the user's prompt to
the conversation history, processes it through the model, executes any tool calls, and returns the final result.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prompt</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The natural language prompt from the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional parameters to pass to the event loop.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="AgentResult


  
      dataclass
   (strands.agent.agent_result.AgentResult)" href="#strands.agent.agent_result.AgentResult">AgentResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Result object containing:</p>
<ul>
<li>stop_reason: Why the event loop stopped (e.g., "end_turn", "max_tokens")</li>
<li>message: The final message from the model</li>
<li>metrics: Performance metrics from the event loop</li>
<li>state: The final state of the event loop</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a natural language prompt through the agent&#39;s event loop.</span>

<span class="sd">    This method implements the conversational interface (e.g., `agent(&quot;hello!&quot;)`). It adds the user&#39;s prompt to</span>
<span class="sd">    the conversation history, processes it through the model, executes any tool calls, and returns the final result.</span>

<span class="sd">    Args:</span>
<span class="sd">        prompt: The natural language prompt from the user.</span>
<span class="sd">        **kwargs: Additional parameters to pass to the event loop.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Result object containing:</span>

<span class="sd">            - stop_reason: Why the event loop stopped (e.g., &quot;end_turn&quot;, &quot;max_tokens&quot;)</span>
<span class="sd">            - message: The final message from the model</span>
<span class="sd">            - metrics: Performance metrics from the event loop</span>
<span class="sd">            - state: The final state of the event loop</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_agent_trace_span</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Run the event loop and get the result</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_loop</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_end_agent_trace_span</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_agent_trace_span</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># Re-raise the exception to preserve original behavior</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="strands.agent.agent.Agent.__del__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__del__</span><span class="p">()</span></code>

<a href="#strands.agent.agent.Agent.__del__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Clean up resources when Agent is garbage collected.</p>
<p>Ensures proper shutdown of the thread pool executor if one exists.</p>


            <details class="quote">
              <summary>Source code in <code>strands/agent/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clean up resources when Agent is garbage collected.</span>

<span class="sd">    Ensures proper shutdown of the thread pool executor if one exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool_wrapper</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread_pool_wrapper</span><span class="p">,</span> <span class="s2">&quot;shutdown&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool_wrapper</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;thread pool executor shutdown complete&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="strands.agent.agent.Agent.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">system_prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callback_handler</span><span class="o">=</span><span class="n">_DEFAULT_CALLBACK_HANDLER</span><span class="p">,</span> <span class="n">conversation_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_parallel_tools</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">,</span> <span class="n">record_direct_tool_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">load_tools_from_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trace_attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#strands.agent.agent.Agent.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Initialize the Agent with the specified configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="Model (strands.types.models.Model)" href="../types/#strands.types.models.Model">Model</a>, <span title="str">str</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provider for running inference or a string representing the model-id for Bedrock to use.
Defaults to strands.models.BedrockModel if None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>messages</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="Messages = List[Message]

  
      module-attribute
   (strands.types.content.Messages)" href="../types/#strands.types.content.Messages">Messages</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of initial messages to pre-load into the conversation.
Defaults to an empty list if None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tools</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>], <span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of tools to make available to the agent.
Can be specified as:</p>
<ul>
<li>String tool names (e.g., "retrieve")</li>
<li>File paths (e.g., "/path/to/tool.py")</li>
<li>Imported Python modules (e.g., from strands_tools import current_time)</li>
<li>Dictionaries with name/path keys (e.g., {"name": "tool_name", "path": "/path/to/tool.py"})</li>
<li>Functions decorated with <code>@strands.tool</code> decorator.</li>
</ul>
<p>If provided, only these tools will be available. If None, all tools will be available.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>system_prompt</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>System prompt to guide model behavior.
If None, the model will behave according to its default settings.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callback_handler</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Callable">Callable</span>[..., <span title="typing.Any">Any</span>], <span title="strands.agent.agent._DefaultCallbackHandlerSentinel">_DefaultCallbackHandlerSentinel</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callback for processing events as they happen during agent execution.
If not provided (using the default), a new PrintingCallbackHandler instance is created.
If explicitly set to None, null_callback_handler is used.</p>
              </div>
            </td>
            <td>
                  <code><span title="strands.agent.agent._DEFAULT_CALLBACK_HANDLER">_DEFAULT_CALLBACK_HANDLER</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_manager</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="ConversationManager (strands.agent.conversation_manager.ConversationManager)" href="#strands.agent.conversation_manager.conversation_manager.ConversationManager">ConversationManager</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Manager for conversation history and context window.
Defaults to strands.agent.conversation_manager.SlidingWindowConversationManager if None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_parallel_tools</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of tools to run in parallel when the model returns multiple tool calls.
Defaults to os.cpu_count() or 1.</p>
              </div>
            </td>
            <td>
                  <code><span title="os.cpu_count">cpu_count</span>() or 1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>record_direct_tool_call</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to record direct tool calls in message history.
Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load_tools_from_directory</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to load and automatically reload tools in the <code>./tools/</code> directory.
Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trace_attributes</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Mapping">Mapping</span>[<span title="str">str</span>, <span title="strands.types.traces.AttributeValue">AttributeValue</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom trace attributes to apply to the agent's trace span.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If max_parallel_tools is less than 1.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Model</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">messages</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Messages</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">system_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callback_handler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">_DefaultCallbackHandlerSentinel</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">_DEFAULT_CALLBACK_HANDLER</span><span class="p">,</span>
    <span class="n">conversation_manager</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConversationManager</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_parallel_tools</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">record_direct_tool_call</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">load_tools_from_directory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">trace_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AttributeValue</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the Agent with the specified configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: Provider for running inference or a string representing the model-id for Bedrock to use.</span>
<span class="sd">            Defaults to strands.models.BedrockModel if None.</span>
<span class="sd">        messages: List of initial messages to pre-load into the conversation.</span>
<span class="sd">            Defaults to an empty list if None.</span>
<span class="sd">        tools: List of tools to make available to the agent.</span>
<span class="sd">            Can be specified as:</span>

<span class="sd">            - String tool names (e.g., &quot;retrieve&quot;)</span>
<span class="sd">            - File paths (e.g., &quot;/path/to/tool.py&quot;)</span>
<span class="sd">            - Imported Python modules (e.g., from strands_tools import current_time)</span>
<span class="sd">            - Dictionaries with name/path keys (e.g., {&quot;name&quot;: &quot;tool_name&quot;, &quot;path&quot;: &quot;/path/to/tool.py&quot;})</span>
<span class="sd">            - Functions decorated with `@strands.tool` decorator.</span>

<span class="sd">            If provided, only these tools will be available. If None, all tools will be available.</span>
<span class="sd">        system_prompt: System prompt to guide model behavior.</span>
<span class="sd">            If None, the model will behave according to its default settings.</span>
<span class="sd">        callback_handler: Callback for processing events as they happen during agent execution.</span>
<span class="sd">            If not provided (using the default), a new PrintingCallbackHandler instance is created.</span>
<span class="sd">            If explicitly set to None, null_callback_handler is used.</span>
<span class="sd">        conversation_manager: Manager for conversation history and context window.</span>
<span class="sd">            Defaults to strands.agent.conversation_manager.SlidingWindowConversationManager if None.</span>
<span class="sd">        max_parallel_tools: Maximum number of tools to run in parallel when the model returns multiple tool calls.</span>
<span class="sd">            Defaults to os.cpu_count() or 1.</span>
<span class="sd">        record_direct_tool_call: Whether to record direct tool calls in message history.</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">        load_tools_from_directory: Whether to load and automatically reload tools in the `./tools/` directory.</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">        trace_attributes: Custom trace attributes to apply to the agent&#39;s trace span.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If max_parallel_tools is less than 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">BedrockModel</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span> <span class="k">else</span> <span class="n">BedrockModel</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">model</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="n">messages</span> <span class="k">if</span> <span class="n">messages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">system_prompt</span> <span class="o">=</span> <span class="n">system_prompt</span>

    <span class="c1"># If not provided, create a new PrintingCallbackHandler instance</span>
    <span class="c1"># If explicitly set to None, use null_callback_handler</span>
    <span class="c1"># Otherwise use the passed callback_handler</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">callback_handler</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">PrintingCallbackHandler</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback_handler</span><span class="p">,</span> <span class="n">_DefaultCallbackHandlerSentinel</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_handler</span> <span class="o">=</span> <span class="n">PrintingCallbackHandler</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">callback_handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_handler</span> <span class="o">=</span> <span class="n">null_callback_handler</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_handler</span> <span class="o">=</span> <span class="n">callback_handler</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">conversation_manager</span> <span class="o">=</span> <span class="n">conversation_manager</span> <span class="k">if</span> <span class="n">conversation_manager</span> <span class="k">else</span> <span class="n">SlidingWindowConversationManager</span><span class="p">()</span>

    <span class="c1"># Process trace attributes to ensure they&#39;re of compatible types</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trace_attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AttributeValue</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">trace_attributes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">trace_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trace_attributes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="c1"># If max_parallel_tools is 1, we execute tools sequentially</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool_wrapper</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">max_parallel_tools</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_parallel_tools</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_pool_wrapper</span> <span class="o">=</span> <span class="n">ThreadPoolExecutorWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread_pool</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">max_parallel_tools</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_parallel_tools must be greater than 0&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">record_direct_tool_call</span> <span class="o">=</span> <span class="n">record_direct_tool_call</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_tools_from_directory</span> <span class="o">=</span> <span class="n">load_tools_from_directory</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tool_registry</span> <span class="o">=</span> <span class="n">ToolRegistry</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tool_handler</span> <span class="o">=</span> <span class="n">AgentToolHandler</span><span class="p">(</span><span class="n">tool_registry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tool_registry</span><span class="p">)</span>

    <span class="c1"># Process tool list if provided</span>
    <span class="k">if</span> <span class="n">tools</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tool_registry</span><span class="o">.</span><span class="n">process_tools</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>

    <span class="c1"># Initialize tools and configuration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tool_registry</span><span class="o">.</span><span class="n">initialize_tools</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_tools_from_directory</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">load_tools_from_directory</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tool_watcher</span> <span class="o">=</span> <span class="n">ToolWatcher</span><span class="p">(</span><span class="n">tool_registry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tool_registry</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">event_loop_metrics</span> <span class="o">=</span> <span class="n">EventLoopMetrics</span><span class="p">()</span>

    <span class="c1"># Initialize tracer instance (no-op if not configured)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tracer</span> <span class="o">=</span> <span class="n">get_tracer</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trace_span</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">trace</span><span class="o">.</span><span class="n">Span</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tool_caller</span> <span class="o">=</span> <span class="n">Agent</span><span class="o">.</span><span class="n">ToolCaller</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="strands.agent.agent.Agent.stream_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stream_async</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#strands.agent.agent.Agent.stream_async" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Process a natural language prompt and yield events as an async iterator.</p>
<p>This method provides an asynchronous interface for streaming agent events, allowing
consumers to process stream events programmatically through an async iterator pattern
rather than callback functions. This is particularly useful for web servers and other
async environments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prompt</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The natural language prompt from the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional parameters to pass to the event loop.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.AsyncIterator">AsyncIterator</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An async iterator that yields events. Each event is a dictionary containing</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.AsyncIterator">AsyncIterator</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>information about the current state of processing, such as:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.AsyncIterator">AsyncIterator</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>data: Text content being generated</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.AsyncIterator">AsyncIterator</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>complete: Whether this is the final chunk</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.AsyncIterator">AsyncIterator</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>current_tool_use: Information about tools being executed</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.AsyncIterator">AsyncIterator</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>And other event data provided by the callback handler</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Any exceptions from the agent invocation will be propagated to the caller.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">stream_async</span><span class="p">(</span><span class="s2">&quot;Analyze this data&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
</code></pre></div>
</details>

            <details class="quote">
              <summary>Source code in <code>strands/agent/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stream_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a natural language prompt and yield events as an async iterator.</span>

<span class="sd">    This method provides an asynchronous interface for streaming agent events, allowing</span>
<span class="sd">    consumers to process stream events programmatically through an async iterator pattern</span>
<span class="sd">    rather than callback functions. This is particularly useful for web servers and other</span>
<span class="sd">    async environments.</span>

<span class="sd">    Args:</span>
<span class="sd">        prompt: The natural language prompt from the user.</span>
<span class="sd">        **kwargs: Additional parameters to pass to the event loop.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An async iterator that yields events. Each event is a dictionary containing</span>
<span class="sd">        information about the current state of processing, such as:</span>
<span class="sd">        - data: Text content being generated</span>
<span class="sd">        - complete: Whether this is the final chunk</span>
<span class="sd">        - current_tool_use: Information about tools being executed</span>
<span class="sd">        - And other event data provided by the callback handler</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: Any exceptions from the agent invocation will be propagated to the caller.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        async for event in agent.stream_async(&quot;Analyze this data&quot;):</span>
<span class="sd">            if &quot;data&quot; in event:</span>
<span class="sd">                yield event[&quot;data&quot;]</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_agent_trace_span</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

    <span class="n">_stop_event</span> <span class="o">=</span> <span class="n">uuid4</span><span class="p">()</span>

    <span class="n">queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">[</span><span class="n">Any</span><span class="p">]()</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">enqueue</span><span class="p">(</span><span class="n">an_item</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">nonlocal</span> <span class="n">queue</span>
        <span class="k">nonlocal</span> <span class="n">loop</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">call_soon_threadsafe</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">,</span> <span class="n">an_item</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">queuing_callback_handler</span><span class="p">(</span><span class="o">**</span><span class="n">handler_kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">enqueue</span><span class="p">(</span><span class="n">handler_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">target_callback</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">nonlocal</span> <span class="n">kwargs</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_loop</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">supplementary_callback_handler</span><span class="o">=</span><span class="n">queuing_callback_handler</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_agent_trace_span</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_agent_trace_span</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
            <span class="n">enqueue</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">enqueue</span><span class="p">(</span><span class="n">_stop_event</span><span class="p">)</span>

    <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target_callback</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">_stop_event</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">item</span>
            <span class="k">yield</span> <span class="n">item</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="strands.agent.agent_result" class="doc doc-heading">
            <code>strands.agent.agent_result</code>


<a href="#strands.agent.agent_result" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Agent result handling for SDK.</p>
<p>This module defines the AgentResult class which encapsulates the complete response from an agent's processing cycle.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="strands.agent.agent_result.AgentResult" class="doc doc-heading">
            <code>AgentResult</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#strands.agent.agent_result.AgentResult" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">


        <p>Represents the last result of invoking an agent with a prompt.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="strands.agent.agent_result.AgentResult.stop_reason">stop_reason</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="StopReason = Literal['content_filtered', 'end_turn', 'guardrail_intervened', 'max_tokens', 'stop_sequence', 'tool_use']

  
      module-attribute
   (strands.types.streaming.StopReason)" href="../types/#strands.types.event_loop.StopReason">StopReason</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The reason why the agent's processing stopped.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="strands.agent.agent_result.AgentResult.message">message</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (strands.types.content.Message)" href="../types/#strands.types.content.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The last message generated by the agent.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="strands.agent.agent_result.AgentResult.metrics">metrics</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EventLoopMetrics


  
      dataclass
   (strands.telemetry.metrics.EventLoopMetrics)" href="../telemetry/#strands.telemetry.metrics.EventLoopMetrics">EventLoopMetrics</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Performance metrics collected during processing.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="strands.agent.agent_result.AgentResult.state">state</span></code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional state information from the event loop.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>strands/agent/agent_result.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AgentResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents the last result of invoking an agent with a prompt.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        stop_reason: The reason why the agent&#39;s processing stopped.</span>
<span class="sd">        message: The last message generated by the agent.</span>
<span class="sd">        metrics: Performance metrics collected during processing.</span>
<span class="sd">        state: Additional state information from the event loop.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stop_reason</span><span class="p">:</span> <span class="n">StopReason</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">EventLoopMetrics</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">Any</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the agent&#39;s last message as a string.</span>

<span class="sd">        This method extracts and concatenates all text content from the final message, ignoring any non-text content</span>
<span class="sd">        like images or structured data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The agent&#39;s last message as a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">content_array</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="strands.agent.agent_result.AgentResult.__str__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

<a href="#strands.agent.agent_result.AgentResult.__str__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get the agent's last message as a string.</p>
<p>This method extracts and concatenates all text content from the final message, ignoring any non-text content
like images or structured data.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The agent's last message as a string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/agent_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the agent&#39;s last message as a string.</span>

<span class="sd">    This method extracts and concatenates all text content from the final message, ignoring any non-text content</span>
<span class="sd">    like images or structured data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The agent&#39;s last message as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">content_array</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="strands.agent.conversation_manager" class="doc doc-heading">
            <code>strands.agent.conversation_manager</code>


<a href="#strands.agent.conversation_manager" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>This package provides classes for managing conversation history during agent execution.</p>
<p>It includes:</p>
<ul>
<li>ConversationManager: Abstract base class defining the conversation management interface</li>
<li>NullConversationManager: A no-op implementation that does not modify conversation history</li>
<li>SlidingWindowConversationManager: An implementation that maintains a sliding window of messages to control context
  size while preserving conversation coherence</li>
</ul>
<p>Conversation managers help control memory usage and context length while maintaining relevant conversation state, which
is critical for effective agent interactions.</p>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="strands.agent.conversation_manager.conversation_manager" class="doc doc-heading">
            <code>strands.agent.conversation_manager.conversation_manager</code>


<a href="#strands.agent.conversation_manager.conversation_manager" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents first">

        <p>Abstract interface for conversation history management.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="strands.agent.conversation_manager.conversation_manager.ConversationManager" class="doc doc-heading">
            <code>ConversationManager</code>


<a href="#strands.agent.conversation_manager.conversation_manager.ConversationManager" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for managing conversation history.</p>
<p>This class provides an interface for implementing conversation management strategies to control the size of message
arrays/conversation histories, helping to:</p>
<ul>
<li>Manage memory usage</li>
<li>Control context length</li>
<li>Maintain relevant conversation state</li>
</ul>







              <details class="quote">
                <summary>Source code in <code>strands/agent/conversation_manager/conversation_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConversationManager</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for managing conversation history.</span>

<span class="sd">    This class provides an interface for implementing conversation management strategies to control the size of message</span>
<span class="sd">    arrays/conversation histories, helping to:</span>

<span class="sd">    - Manage memory usage</span>
<span class="sd">    - Control context length</span>
<span class="sd">    - Maintain relevant conversation state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="c1"># pragma: no cover</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_management</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies management strategy to the provided agent.</span>

<span class="sd">        Processes the conversation history to maintain appropriate size by modifying the messages list in-place.</span>
<span class="sd">        Implementations should handle message pruning, summarization, or other size management techniques to keep the</span>
<span class="sd">        conversation context within desired bounds.</span>

<span class="sd">        Args:</span>
<span class="sd">            agent: The agent whose conversation history will be manage.</span>
<span class="sd">                This list is modified in-place.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="c1"># pragma: no cover</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">reduce_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called when the model&#39;s context window is exceeded.</span>

<span class="sd">        This method should implement the specific strategy for reducing the window size when a context overflow occurs.</span>
<span class="sd">        It is typically called after a ContextWindowOverflowException is caught.</span>

<span class="sd">        Implementations might use strategies such as:</span>

<span class="sd">        - Removing the N oldest messages</span>
<span class="sd">        - Summarizing older context</span>
<span class="sd">        - Applying importance-based filtering</span>
<span class="sd">        - Maintaining critical conversation markers</span>

<span class="sd">        Args:</span>
<span class="sd">            agent: The agent whose conversation history will be reduced.</span>
<span class="sd">                This list is modified in-place.</span>
<span class="sd">            e: The exception that triggered the context reduction, if any.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="strands.agent.conversation_manager.conversation_manager.ConversationManager.apply_management" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_management</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#strands.agent.conversation_manager.conversation_manager.ConversationManager.apply_management" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Applies management strategy to the provided agent.</p>
<p>Processes the conversation history to maintain appropriate size by modifying the messages list in-place.
Implementations should handle message pruning, summarization, or other size management techniques to keep the
conversation context within desired bounds.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>agent</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Agent (strands.agent.agent.Agent)" href="#strands.agent.agent.Agent">Agent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The agent whose conversation history will be manage.
This list is modified in-place.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/conversation_manager/conversation_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="c1"># pragma: no cover</span>
<span class="k">def</span><span class="w"> </span><span class="nf">apply_management</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies management strategy to the provided agent.</span>

<span class="sd">    Processes the conversation history to maintain appropriate size by modifying the messages list in-place.</span>
<span class="sd">    Implementations should handle message pruning, summarization, or other size management techniques to keep the</span>
<span class="sd">    conversation context within desired bounds.</span>

<span class="sd">    Args:</span>
<span class="sd">        agent: The agent whose conversation history will be manage.</span>
<span class="sd">            This list is modified in-place.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="strands.agent.conversation_manager.conversation_manager.ConversationManager.reduce_context" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reduce_context</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#strands.agent.conversation_manager.conversation_manager.ConversationManager.reduce_context" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Called when the model's context window is exceeded.</p>
<p>This method should implement the specific strategy for reducing the window size when a context overflow occurs.
It is typically called after a ContextWindowOverflowException is caught.</p>
<p>Implementations might use strategies such as:</p>
<ul>
<li>Removing the N oldest messages</li>
<li>Summarizing older context</li>
<li>Applying importance-based filtering</li>
<li>Maintaining critical conversation markers</li>
</ul>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>agent</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Agent (strands.agent.agent.Agent)" href="#strands.agent.agent.Agent">Agent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The agent whose conversation history will be reduced.
This list is modified in-place.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>e</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="Exception">Exception</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The exception that triggered the context reduction, if any.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/conversation_manager/conversation_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="c1"># pragma: no cover</span>
<span class="k">def</span><span class="w"> </span><span class="nf">reduce_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Called when the model&#39;s context window is exceeded.</span>

<span class="sd">    This method should implement the specific strategy for reducing the window size when a context overflow occurs.</span>
<span class="sd">    It is typically called after a ContextWindowOverflowException is caught.</span>

<span class="sd">    Implementations might use strategies such as:</span>

<span class="sd">    - Removing the N oldest messages</span>
<span class="sd">    - Summarizing older context</span>
<span class="sd">    - Applying importance-based filtering</span>
<span class="sd">    - Maintaining critical conversation markers</span>

<span class="sd">    Args:</span>
<span class="sd">        agent: The agent whose conversation history will be reduced.</span>
<span class="sd">            This list is modified in-place.</span>
<span class="sd">        e: The exception that triggered the context reduction, if any.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="strands.agent.conversation_manager.null_conversation_manager" class="doc doc-heading">
            <code>strands.agent.conversation_manager.null_conversation_manager</code>


<a href="#strands.agent.conversation_manager.null_conversation_manager" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents first">

        <p>Null implementation of conversation management.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="strands.agent.conversation_manager.null_conversation_manager.NullConversationManager" class="doc doc-heading">
            <code>NullConversationManager</code>


<a href="#strands.agent.conversation_manager.null_conversation_manager.NullConversationManager" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConversationManager (strands.agent.conversation_manager.conversation_manager.ConversationManager)" href="#strands.agent.conversation_manager.conversation_manager.ConversationManager">ConversationManager</a></code></p>


        <p>A no-op conversation manager that does not modify the conversation history.</p>
<p>Useful for:</p>
<ul>
<li>Testing scenarios where conversation management should be disabled</li>
<li>Cases where conversation history is managed externally</li>
<li>Situations where the full conversation history should be preserved</li>
</ul>







              <details class="quote">
                <summary>Source code in <code>strands/agent/conversation_manager/null_conversation_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NullConversationManager</span><span class="p">(</span><span class="n">ConversationManager</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A no-op conversation manager that does not modify the conversation history.</span>

<span class="sd">    Useful for:</span>

<span class="sd">    - Testing scenarios where conversation management should be disabled</span>
<span class="sd">    - Cases where conversation history is managed externally</span>
<span class="sd">    - Situations where the full conversation history should be preserved</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_management</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Does nothing to the conversation history.</span>

<span class="sd">        Args:</span>
<span class="sd">            agent: The agent whose conversation history will remain unmodified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reduce_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Does not reduce context and raises an exception.</span>

<span class="sd">        Args:</span>
<span class="sd">            agent: The agent whose conversation history will remain unmodified.</span>
<span class="sd">            e: The exception that triggered the context reduction, if any.</span>

<span class="sd">        Raises:</span>
<span class="sd">            e: If provided.</span>
<span class="sd">            ContextWindowOverflowException: If e is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ContextWindowOverflowException</span><span class="p">(</span><span class="s2">&quot;Context window overflowed!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="strands.agent.conversation_manager.null_conversation_manager.NullConversationManager.apply_management" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_management</span><span class="p">(</span><span class="n">_agent</span><span class="p">)</span></code>

<a href="#strands.agent.conversation_manager.null_conversation_manager.NullConversationManager.apply_management" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Does nothing to the conversation history.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>agent</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The agent whose conversation history will remain unmodified.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/conversation_manager/null_conversation_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_management</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Does nothing to the conversation history.</span>

<span class="sd">    Args:</span>
<span class="sd">        agent: The agent whose conversation history will remain unmodified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="strands.agent.conversation_manager.null_conversation_manager.NullConversationManager.reduce_context" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reduce_context</span><span class="p">(</span><span class="n">_agent</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#strands.agent.conversation_manager.null_conversation_manager.NullConversationManager.reduce_context" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Does not reduce context and raises an exception.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>agent</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The agent whose conversation history will remain unmodified.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>e</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="Exception">Exception</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The exception that triggered the context reduction, if any.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="e">e</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ContextWindowOverflowException (strands.types.exceptions.ContextWindowOverflowException)" href="../types/#strands.types.exceptions.ContextWindowOverflowException">ContextWindowOverflowException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If e is None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/conversation_manager/null_conversation_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reduce_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Does not reduce context and raises an exception.</span>

<span class="sd">    Args:</span>
<span class="sd">        agent: The agent whose conversation history will remain unmodified.</span>
<span class="sd">        e: The exception that triggered the context reduction, if any.</span>

<span class="sd">    Raises:</span>
<span class="sd">        e: If provided.</span>
<span class="sd">        ContextWindowOverflowException: If e is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ContextWindowOverflowException</span><span class="p">(</span><span class="s2">&quot;Context window overflowed!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="strands.agent.conversation_manager.sliding_window_conversation_manager" class="doc doc-heading">
            <code>strands.agent.conversation_manager.sliding_window_conversation_manager</code>


<a href="#strands.agent.conversation_manager.sliding_window_conversation_manager" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents first">

        <p>Sliding window conversation history management.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager" class="doc doc-heading">
            <code>SlidingWindowConversationManager</code>


<a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConversationManager (strands.agent.conversation_manager.conversation_manager.ConversationManager)" href="#strands.agent.conversation_manager.conversation_manager.ConversationManager">ConversationManager</a></code></p>


        <p>Implements a sliding window strategy for managing conversation history.</p>
<p>This class handles the logic of maintaining a conversation window that preserves tool usage pairs and avoids
invalid window states.</p>







              <details class="quote">
                <summary>Source code in <code>strands/agent/conversation_manager/sliding_window_conversation_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SlidingWindowConversationManager</span><span class="p">(</span><span class="n">ConversationManager</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implements a sliding window strategy for managing conversation history.</span>

<span class="sd">    This class handles the logic of maintaining a conversation window that preserves tool usage pairs and avoids</span>
<span class="sd">    invalid window states.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the sliding window conversation manager.</span>

<span class="sd">        Args:</span>
<span class="sd">            window_size: Maximum number of messages to keep in the agent&#39;s history.</span>
<span class="sd">                Defaults to 40 messages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_management</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the sliding window to the agent&#39;s messages array to maintain a manageable history size.</span>

<span class="sd">        This method is called after every event loop cycle, as the messages array may have been modified with tool</span>
<span class="sd">        results and assistant responses. It first removes any dangling messages that might create an invalid</span>
<span class="sd">        conversation state, then applies the sliding window if the message count exceeds the window size.</span>

<span class="sd">        Special handling is implemented to ensure we don&#39;t leave a user message with toolResult</span>
<span class="sd">        as the first message in the array. It also ensures that all toolUse blocks have corresponding toolResult</span>
<span class="sd">        blocks to maintain conversation coherence.</span>

<span class="sd">        Args:</span>
<span class="sd">            agent: The agent whose messages will be managed.</span>
<span class="sd">                This list is modified in-place.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_dangling_messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;window_size=&lt;</span><span class="si">%s</span><span class="s2">&gt;, message_count=&lt;</span><span class="si">%s</span><span class="s2">&gt; | skipping context reduction&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduce_context</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_remove_dangling_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">Messages</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove dangling messages that would create an invalid conversation state.</span>

<span class="sd">        After the event loop cycle is executed, we expect the messages array to end with either an assistant tool use</span>
<span class="sd">        request followed by the pairing user tool result or an assistant response with no tool use request. If the</span>
<span class="sd">        event loop cycle fails, we may end up in an invalid message state, and so this method will remove problematic</span>
<span class="sd">        messages from the end of the array.</span>

<span class="sd">        This method handles two specific cases:</span>

<span class="sd">        - User with no tool result: Indicates that event loop failed to generate an assistant tool use request</span>
<span class="sd">        - Assistant with tool use request: Indicates that event loop failed to generate a pairing user tool result</span>

<span class="sd">        Args:</span>
<span class="sd">            messages: The messages to clean up.</span>
<span class="sd">                This list is modified in-place.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># remove any dangling user messages with no ToolResult</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">is_user_message</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;toolResult&quot;</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">]):</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="c1"># remove any dangling assistant messages with ToolUse</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">is_assistant_message</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;toolUse&quot;</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">]):</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="c1"># remove remaining dangling user messages with no ToolResult after we popped off an assistant message</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">is_user_message</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;toolResult&quot;</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">]):</span>
                        <span class="n">messages</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reduce_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trim the oldest messages to reduce the conversation context size.</span>

<span class="sd">        The method handles special cases where trimming the messages leads to:</span>
<span class="sd">         - toolResult with no corresponding toolUse</span>
<span class="sd">         - toolUse with no corresponding toolResult</span>

<span class="sd">        Args:</span>
<span class="sd">            agent: The agent whose messages will be reduce.</span>
<span class="sd">                This list is modified in-place.</span>
<span class="sd">            e: The exception that triggered the context reduction, if any.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ContextWindowOverflowException: If the context cannot be reduced further.</span>
<span class="sd">                Such as when the conversation is already minimal or when tool result messages cannot be properly</span>
<span class="sd">                converted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">messages</span>
        <span class="c1"># If the number of messages is less than the window_size, then we default to 2, otherwise, trim to window size</span>
        <span class="n">trim_index</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>

        <span class="c1"># Find the next valid trim_index</span>
        <span class="k">while</span> <span class="n">trim_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="c1"># Oldest message cannot be a toolResult because it needs a toolUse preceding it</span>
                <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;toolResult&quot;</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">[</span><span class="n">trim_index</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
                <span class="ow">or</span> <span class="p">(</span>
                    <span class="c1"># Oldest message can be a toolUse only if a toolResult immediately follows it.</span>
                    <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;toolUse&quot;</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">[</span><span class="n">trim_index</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
                    <span class="ow">and</span> <span class="n">trim_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;toolResult&quot;</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">[</span><span class="n">trim_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="n">trim_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If we didn&#39;t find a valid trim_index, then we throw</span>
            <span class="k">raise</span> <span class="n">ContextWindowOverflowException</span><span class="p">(</span><span class="s2">&quot;Unable to trim conversation context!&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="c1"># Overwrite message history</span>
        <span class="n">messages</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="n">trim_index</span><span class="p">:]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span></code>

<a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager.__init__" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Initialize the sliding window conversation manager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>window_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of messages to keep in the agent's history.
Defaults to 40 messages.</p>
              </div>
            </td>
            <td>
                  <code>40</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/conversation_manager/sliding_window_conversation_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the sliding window conversation manager.</span>

<span class="sd">    Args:</span>
<span class="sd">        window_size: Maximum number of messages to keep in the agent&#39;s history.</span>
<span class="sd">            Defaults to 40 messages.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager.apply_management" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_management</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span></code>

<a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager.apply_management" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Apply the sliding window to the agent's messages array to maintain a manageable history size.</p>
<p>This method is called after every event loop cycle, as the messages array may have been modified with tool
results and assistant responses. It first removes any dangling messages that might create an invalid
conversation state, then applies the sliding window if the message count exceeds the window size.</p>
<p>Special handling is implemented to ensure we don't leave a user message with toolResult
as the first message in the array. It also ensures that all toolUse blocks have corresponding toolResult
blocks to maintain conversation coherence.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>agent</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Agent (strands.agent.agent.Agent)" href="#strands.agent.agent.Agent">Agent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The agent whose messages will be managed.
This list is modified in-place.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/conversation_manager/sliding_window_conversation_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_management</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply the sliding window to the agent&#39;s messages array to maintain a manageable history size.</span>

<span class="sd">    This method is called after every event loop cycle, as the messages array may have been modified with tool</span>
<span class="sd">    results and assistant responses. It first removes any dangling messages that might create an invalid</span>
<span class="sd">    conversation state, then applies the sliding window if the message count exceeds the window size.</span>

<span class="sd">    Special handling is implemented to ensure we don&#39;t leave a user message with toolResult</span>
<span class="sd">    as the first message in the array. It also ensures that all toolUse blocks have corresponding toolResult</span>
<span class="sd">    blocks to maintain conversation coherence.</span>

<span class="sd">    Args:</span>
<span class="sd">        agent: The agent whose messages will be managed.</span>
<span class="sd">            This list is modified in-place.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">messages</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_remove_dangling_messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;window_size=&lt;</span><span class="si">%s</span><span class="s2">&gt;, message_count=&lt;</span><span class="si">%s</span><span class="s2">&gt; | skipping context reduction&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
        <span class="p">)</span>
        <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reduce_context</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager.reduce_context" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reduce_context</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.SlidingWindowConversationManager.reduce_context" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Trim the oldest messages to reduce the conversation context size.</p>


<details class="the-method-handles-special-cases-where-trimming-the-messages-leads-to" open>
  <summary>The method handles special cases where trimming the messages leads to</summary>
  <ul>
<li>toolResult with no corresponding toolUse</li>
<li>toolUse with no corresponding toolResult</li>
</ul>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>agent</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Agent (strands.agent.agent.Agent)" href="#strands.agent.agent.Agent">Agent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The agent whose messages will be reduce.
This list is modified in-place.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>e</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="Exception">Exception</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The exception that triggered the context reduction, if any.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ContextWindowOverflowException (strands.types.exceptions.ContextWindowOverflowException)" href="../types/#strands.types.exceptions.ContextWindowOverflowException">ContextWindowOverflowException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the context cannot be reduced further.
Such as when the conversation is already minimal or when tool result messages cannot be properly
converted.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/conversation_manager/sliding_window_conversation_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reduce_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">&quot;Agent&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trim the oldest messages to reduce the conversation context size.</span>

<span class="sd">    The method handles special cases where trimming the messages leads to:</span>
<span class="sd">     - toolResult with no corresponding toolUse</span>
<span class="sd">     - toolUse with no corresponding toolResult</span>

<span class="sd">    Args:</span>
<span class="sd">        agent: The agent whose messages will be reduce.</span>
<span class="sd">            This list is modified in-place.</span>
<span class="sd">        e: The exception that triggered the context reduction, if any.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ContextWindowOverflowException: If the context cannot be reduced further.</span>
<span class="sd">            Such as when the conversation is already minimal or when tool result messages cannot be properly</span>
<span class="sd">            converted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">messages</span>
    <span class="c1"># If the number of messages is less than the window_size, then we default to 2, otherwise, trim to window size</span>
    <span class="n">trim_index</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>

    <span class="c1"># Find the next valid trim_index</span>
    <span class="k">while</span> <span class="n">trim_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="c1"># Oldest message cannot be a toolResult because it needs a toolUse preceding it</span>
            <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;toolResult&quot;</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">[</span><span class="n">trim_index</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
            <span class="ow">or</span> <span class="p">(</span>
                <span class="c1"># Oldest message can be a toolUse only if a toolResult immediately follows it.</span>
                <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;toolUse&quot;</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">[</span><span class="n">trim_index</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
                <span class="ow">and</span> <span class="n">trim_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;toolResult&quot;</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">[</span><span class="n">trim_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="n">trim_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If we didn&#39;t find a valid trim_index, then we throw</span>
        <span class="k">raise</span> <span class="n">ContextWindowOverflowException</span><span class="p">(</span><span class="s2">&quot;Unable to trim conversation context!&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="c1"># Overwrite message history</span>
    <span class="n">messages</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="n">trim_index</span><span class="p">:]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="strands.agent.conversation_manager.sliding_window_conversation_manager.is_assistant_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_assistant_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

<a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.is_assistant_message" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Check if a message is from an assistant.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (strands.types.content.Message)" href="../types/#strands.types.content.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The message object to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the message has the assistant role, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/conversation_manager/sliding_window_conversation_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_assistant_message</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a message is from an assistant.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: The message object to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the message has the assistant role, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;assistant&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="strands.agent.conversation_manager.sliding_window_conversation_manager.is_user_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_user_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

<a href="#strands.agent.conversation_manager.sliding_window_conversation_manager.is_user_message" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Check if a message is from a user.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (strands.types.content.Message)" href="../types/#strands.types.content.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The message object to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the message has the user role, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>strands/agent/conversation_manager/sliding_window_conversation_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_user_message</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a message is from a user.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: The message object to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the message has the user role, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;user&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>